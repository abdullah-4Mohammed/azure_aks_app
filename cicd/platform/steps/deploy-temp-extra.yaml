parameters:
  - name: environment
    type: string
  - name: location
    type: string
  - name: resourceGroupName
    type: string
  - name: clusterName
    type: string
  - name: kubernetesVersion
    type: string
  - name: systemNodeCount
    type: number
  - name: acrName
    type: string
  - name: workingDirectory
    type: string
  - name: backendType
    type: string
  - name: backendServiceArmConnection
    type: string
  - name: backendAzureRmResourceGroupName
    type: string
  - name: backendAzureRmStorageAccountName
    type: string
  - name: backendAzureRmContainerName
    type: string
  - name: backendAzureRmKey
    type: string

steps:
  # Connect to AKS
  - task: AzureCLI@2
    displayName: 'Connect to AKS'
    inputs:
      azureSubscription: ${{ parameters.backendServiceArmConnection }}
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        az aks get-credentials --name ${{parameters.clusterName}}  --resource-group ${{parameters.resourceGroupName}} --admin
    
#extra - deploying the web-ui and other services
  - script: |
      set -x
      kubectl apply -f $(System.DefaultWorkingDirectory)/deploy/*.yaml
      kubectl apply -f $(System.DefaultWorkingDirectory)/deploy/*.yaml
    displayName: 'Deploy web-ui' 

